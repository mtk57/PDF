WCF memo


■基本

・Windows Communication Foundation

・.NET Framework 3.0から導入

・クライアントと通信を行う際のフレームワーク（多くのプロトコルをサポート）
　⇒いずれのプロトコルを用いるにしても共通のアプローチで実装を進めることが可

・

■使用可能なプロトコル

・TCP

・HTTP

・Named Pipe

・MSMQ

・P2P


■重要な概念 ABC

Address：サービスを提供する場所

Binding：サービスで使用するバインディング

Contract：サービスの内容



・「どこで（Address）・どのように（Binding）・何を（Contract）」提供するかを定義

・サービス提供側とクライアント側双方で同じ「ABC」を使用することで、齟齬のない通信を行う

・これらの「ABC」をまとめてEndpointという。

・サービスを提供/使用するためのソケットのようなイメージ

・「ABC」はソースコード or XML のどちらかで定義する

XMLによる「ABC」定義例
<?xml version="1.0" encoding="utf-8"?>
<configuration>
  <system.serviceModel>
    <services>
      <service name="WCFHogeServiceLibrary.FugaService">
        <endpoint address="http://localhost:8080/MogeService" 
                  binding="basicHttpBinding"
                  contract="WCFHogeServiceLibrary.IFugaService" 
                  listenUriMode="Explicit">
        </endpoint>
      </service>
    </services>
  </system.serviceModel>
</configuration>


・XMLの定義は、.NET標準の構成ファイルを使う
　Windowsアプリケーション：app.config
　Webアプリケーション：web.config

　endpoint要素のaddress、binding、contractで「ABC」を定義

・XMLの定義は手動ではなく、VisualStudio付属のツールで行える。

・サービス提供側で定義した「ABC」をクライアント側で共有するには2つの方法がある。

　1.サービス提供側の構成ファイル（app.config、web.config）をクライアント側で読み込み生成
　　⇒configの生成と同時に、サービス提供側で作成したContractのコードをクライアント側にコピー

　2.通信方式としてWebサービスを使用する場合、Webサービスを介してContractのMetaDataを取得







■Address

・URI形式

・要素

　・トランスポートプロトコル
　・ホスト名
　・（必要な場合）ポート番号
　・提供するパス


■Binding

・サービスをどう公開するかを定義

・HTTPの場合：
　・Basic-Profileに準拠する場合とWebサービス拡張仕様に準拠する場合では異なるBindingを使用


WCF標準のBinding

NetTcpBinding
　TCP/IPを使用

BasicHttpBinding
　WebサービスのBasic-Profileを使用

WsHttpBinding
　Webサービス拡張仕様を使用

NetNamedPipeBinding
　名前付きパイプを使用

NetMsmqBinding
　MSMQを使用してWCFコンポーネントと接続

MsmqIntegrationBinding
　MSMQを使用し、WCFコンポーネントでないMSMQアプリケーションと接続





■Contract

・サービスを提供するクラス・インターフェイスの定義であるサービス・コントラクト
・やり取りするメッセージについての定義をするコントラクト
がある

・AddressとBindingは使用する通信方式に依存するが、Contractは「通信方式に依存しない」。



■Endpoint

・複数持てる
　⇒1つのWCFサービス中に、複数の通信方式を持つEndpointを持てる







■参考
https://codezine.jp/article/detail/1157

